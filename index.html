<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>منصة Traof — لوحة تحكم</title>
  <style>
    body { font-family: 'Tahoma', sans-serif; background:#f9fafb; color:#333; margin:0; }
    header { background:linear-gradient(90deg,#0ea5a420,#0ea5a440); padding:1rem 2rem; display:flex; justify-content:space-between; align-items:center; }
    header h1 { color:#0ea5a4; margin:0; font-size:1.5rem; }
    .logo-box {height:48px;width:48px;border:3px solid #0ea5a4;border-radius:8px;display:flex;align-items:center;justify-content:center;background:white;font-weight:bold;}
    .top-left-btn {position:fixed;top:16px;left:16px;z-index:50;background:white;padding:8px 12px;border-radius:50px;box-shadow:0 2px 6px rgba(0,0,0,0.1);cursor:pointer;display:flex;align-items:center;gap:8px;}
    .sidebar {background:white;padding:1rem;border-radius:8px;box-shadow:0 0 6px rgba(0,0,0,0.05);}
    .content {background:white;padding:1.5rem;border-radius:8px;box-shadow:0 0 6px rgba(0,0,0,0.05);}
    .grid {display:grid;gap:1rem;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));}
    .admin-panel {position:fixed;top:0;right:0;width:400px;max-width:100%;height:100%;background:white;box-shadow:-2px 0 10px rgba(0,0,0,0.2);padding:1rem;overflow:auto;z-index:60;}
    .overlay {position:fixed;inset:0;background:rgba(0,0,0,0.4);z-index:55;}
    button, input, select {font-family:inherit;}
    .btn {padding:6px 12px;border:none;border-radius:6px;cursor:pointer;}
    .btn-primary {background:#0ea5a4;color:white;}
    .btn-light {background:#f3f4f6;}
    .menu-item {display:flex;align-items:center;gap:8px;padding:6px;border-radius:6px;}
    .menu-item:hover {background:#f9fafb;}
    .hidden {display:none;}
  </style>
</head>
<body>
  <div class="top-left-btn" id="openAdminBtn">☰ لوحة</div>
  <header>
    <div style="display:flex;align-items:center;gap:12px;">
      <div class="logo-box" id="logoBox">T</div>
      <h1 id="siteName">Traof Platform</h1>
    </div>
    <div>
      <button class="btn btn-light">دخول المنصة</button>
      <button class="btn btn-light" id="adminAccessBtn">دخول لوحة التحكم</button>
    </div>
  </header>
  <main style="padding:1.5rem;display:grid;grid-template-columns:300px 1fr;gap:1rem;max-width:1200px;margin:auto;">
    <aside class="sidebar">
      <h3>قائمة الموقع</h3>
      <ul id="menuList"></ul>
    </aside>
    <section class="content">
      <h2>معاينة المنصة</h2>
      <p>عرض سريع للمحتوى وكيف تظهر التغييرات.</p>
      <div class="grid">
        <div class="content-box"><h4>بطاقة محتوى</h4><div style="height:100px;background:#f3f4f6;display:flex;align-items:center;justify-content:center;">محتوى تجريبي</div></div>
        <div class="content-box"><h4>إحصائية</h4><div style="height:100px;display:flex;align-items:center;justify-content:center;">120 تسجيل</div></div>
        <div class="content-box"><h4>نشاطات</h4><div style="height:100px;display:flex;align-items:center;justify-content:center;">3 فعاليات قادمة</div></div>
      </div>
    </section>
  </main>

  <!-- Overlay and Admin Panel -->
  <div class="overlay hidden" id="overlay"></div>
  <div class="admin-panel hidden" id="adminPanel">
    <h3>لوحة تحكم احترافية</h3>
    <label>اسم الموقع</label>
    <input type="text" id="siteNameInput" class="w-full" style="width:100%;padding:6px;margin-bottom:10px;border:1px solid #ddd;border-radius:6px;">

    <label>اللون الأساسي</label>
    <input type="color" id="primaryColor" style="display:block;margin:6px 0;">

    <label>تحميل شعار</label>
    <input type="file" id="logoUpload" accept="image/*" style="display:block;margin-bottom:10px;">

    <label>القوائم</label>
    <div id="menuEditor"></div>
    <button class="btn btn-light" id="addMenuBtn">إضافة عنصر</button>

    <div style="margin-top:10px;">
      <button class="btn btn-primary" id="saveBtn">حفظ</button>
      <button class="btn btn-light" id="closeBtn">إغلاق</button>
    </div>
  </div>

  <script>
    const defaultConfig = {
      siteName: 'Traof Platform',
      primaryColor: '#0ea5a4',
      logoDataUrl: null,
      menuItems: [
        { label: 'الرئيسية', path: '/', icon: '🏠' },
        { label: 'الدورات', path: '/courses', icon: '🎓' },
        { label: 'المقالات', path: '/articles', icon: '✍️' }
      ]
    };

    let config = JSON.parse(localStorage.getItem('traof_html_config') || JSON.stringify(defaultConfig));

    const siteNameEl = document.getElementById('siteName');
    const logoBox = document.getElementById('logoBox');
    const menuList = document.getElementById('menuList');
    const overlay = document.getElementById('overlay');
    const adminPanel = document.getElementById('adminPanel');

    function renderSite() {
      siteNameEl.textContent = config.siteName;
      logoBox.textContent = config.logoDataUrl ? '' : config.siteName.charAt(0);
      if (config.logoDataUrl) logoBox.innerHTML = `<img src="${config.logoDataUrl}" style="height:90%;object-fit:contain;"/>`;
      logoBox.style.borderColor = config.primaryColor;
      siteNameEl.style.color = config.primaryColor;
      document.querySelector('header').style.background = `linear-gradient(90deg, ${config.primaryColor}20, ${config.primaryColor}40)`;
      menuList.innerHTML = config.menuItems.map(m => `<li class='menu-item'><span>${m.icon}</span> ${m.label}</li>`).join('');
    }

    renderSite();

    document.getElementById('openAdminBtn').onclick = openPanel;
    document.getElementById('adminAccessBtn').onclick = openPanel;
    document.getElementById('closeBtn').onclick = closePanel;
    overlay.onclick = closePanel;

    function openPanel(){
      overlay.classList.remove('hidden');
      adminPanel.classList.remove('hidden');
      document.getElementById('siteNameInput').value = config.siteName;
      document.getElementById('primaryColor').value = config.primaryColor;
      renderMenuEditor();
    }

    function closePanel(){
      overlay.classList.add('hidden');
      adminPanel.classList.add('hidden');
    }

    function renderMenuEditor(){
      const container = document.getElementById('menuEditor');
      container.innerHTML = '';
      config.menuItems.forEach((m, i)=>{
        const div = document.createElement('div');
        div.innerHTML = `<input value='${m.icon}' maxlength='2' style='width:40px;'> <input value='${m.label}' style='width:100px;'> <input value='${m.path}' style='width:100px;'> <button>🗑️</button>`;
        const [icon,label,path,del] = div.querySelectorAll('input,button');
        icon.oninput = ()=>m.icon=icon.value;
        label.oninput = ()=>m.label=label.value;
        path.oninput = ()=>m.path=path.value;
        del.onclick = ()=>{config.menuItems.splice(i,1);renderMenuEditor();};
        container.appendChild(div);
      });
    }

    document.getElementById('addMenuBtn').onclick = ()=>{
      config.menuItems.push({ label:'جديد', path:'/new', icon:'⭐' });
      renderMenuEditor();
    };

    document.getElementById('saveBtn').onclick = ()=>{
      config.siteName = document.getElementById('siteNameInput').value;
      config.primaryColor = document.getElementById('primaryColor').value;
      localStorage.setItem('traof_html_config', JSON.stringify(config));
      renderSite();
      closePanel();
    };

    document.getElementById('logoUpload').onchange = e => {
      const file = e.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = ev => {
        config.logoDataUrl = ev.target.result;
        localStorage.setItem('traof_html_config', JSON.stringify(config));
        renderSite();
      };
      reader.readAsDataURL(file);
    };
  </script>
</body>
</html>
